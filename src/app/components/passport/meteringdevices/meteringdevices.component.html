<div id="floater" *ngIf="(this.settings$ | async).canEdit">
  <div class="container">
    <div class="row">
      <div class="col-md-3" *ngIf="(this.settings$ | async).menuPosition">
      </div>
      <div class="col-md-9">
        <div class="card semitrans">
          <button class="btn btn-space btn-primary savebutton" form="ngform01"><i class="icon icon-left s7-config"></i>
            Сохранить</button>
        </div>
      </div>
    </div>
  </div>
</div>

<form (ngSubmit)="onSubmit(form.value)" id="ngform01" [formGroup]="form" *ngIf="this.devices !== undefined">
  <div class="row">
    <div class="col-sm-12">
      <div class="panel panel-default">
        <div class="panel-body">

          <!-- <div role="alert" *ngIf="this.saveSuccess$ | async"
            class="alert alert-contrast alert-success alert-dismissible">
            <div class="icon"><span class="s7-check"></span></div>
            <div class="message">
              <button type="button" (click)="this.clearMessage()" class="close"><span aria-hidden="true"
                  class="s7-close"></span></button><strong>Сохранено</strong> Данные успешно сохранены
            </div>
          </div>

          <div role="alert" *ngIf="this.saveFail$ | async" class="alert alert-contrast alert-danger">
            <div class="icon"><span class="s7-close"></span></div>
            <div class="message">
              <button type="button" (click)="this.clearMessage()" class="close"><span aria-hidden="true"
                  class="s7-close"></span></button><strong>Ошибка!</strong> {{this.error}}
            </div>
          </div> -->

          <div class="table-responsive noSwipe">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th style="width:15%;">Ресурс</th>
                  <th style="width:10%;">Количество вводов в здание</th>
                  <th style="width:10%;">Тип (марка) прибора</th>
                  <th style="width:10%;">Количество приборов</th>
                  <th style="width:10%;">Балансодержатель прибора</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Электроэнергия в т.ч.:</td>
                  <td class="text-left">{{ sumControlValues('el1', 'ep1') }}</td>
                  <td class="text-right"></td>
                  <td class="text-left">{{ sumControlValues('el3', 'ep3') }}</td>
                  <td class="text-right"></td>
                </tr>
                <tr>
                  <td>- освещение</td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('el1').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="el1" [value]="this.devices.electricity.children.lighting.attrs[0].value"></td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('el2').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="el2" [value]="this.devices.electricity.children.lighting.attrs[1].value"></td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('el3').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="el3" [value]="this.devices.electricity.children.lighting.attrs[2].value"></td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('el4').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="el4" [value]="this.devices.electricity.children.lighting.attrs[3].value"></td>
                </tr>
                <tr>
                  <td>- силовая нагрузка</td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('ep1').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="ep1" [value]="this.devices.electricity.children.power_load.attrs[0].value"></td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('ep2').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="ep2" [value]="this.devices.electricity.children.power_load.attrs[1].value"></td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('ep3').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="ep3" [value]="this.devices.electricity.children.power_load.attrs[2].value"></td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('ep4').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="ep4" [value]="this.devices.electricity.children.power_load.attrs[3].value"></td>
                </tr>
                <tr>
                  <td>Тепловая энергия в т.ч.:</td>
                  <td class="text-left">{{ sumControlValues('teh1', 'tehw1') }}</td>
                  <td class="text-right"></td>
                  <td class="text-left">{{ sumControlValues('teh3', 'tehw3') }}</td>
                  <td class="text-right"></td>
                </tr>
                <tr>
                  <td>- ГВС</td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('teh1').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="teh1" [value]="this.devices.thermal_energy.children.heating.attrs[0].value"></td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('teh2').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="teh2" [value]="this.devices.thermal_energy.children.heating.attrs[1].value"></td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('teh3').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="teh3" [value]="this.devices.thermal_energy.children.heating.attrs[2].value"></td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('teh4').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="teh4" [value]="this.devices.thermal_energy.children.heating.attrs[3].value"></td>
                </tr>
                <tr>
                  <td>- отопление и вентиляция</td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('tehw1').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="tehw1" [value]="this.devices.thermal_energy.children.hot_water.attrs[0].value">
                  </td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('tehw2').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="tehw2" [value]="this.devices.thermal_energy.children.hot_water.attrs[1].value">
                  </td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('tehw3').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="tehw3" [value]="this.devices.thermal_energy.children.hot_water.attrs[2].value">
                  </td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('tehw4').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="tehw4" [value]="this.devices.thermal_energy.children.hot_water.attrs[3].value">
                  </td>
                </tr>
                <tr>
                  <td>Вода холодная</td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('cw1').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="cw1" [value]="this.devices.cold_water.attrs[0].value"></td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('cw2').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="cw2" [value]="this.devices.cold_water.attrs[1].value"></td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('cw3').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="cw3" [value]="this.devices.cold_water.attrs[2].value"></td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('cw4').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="cw4" [value]="this.devices.cold_water.attrs[3].value"></td>
                </tr>
                <tr>
                  <td>Водоотведение</td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('d1').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="d1" [value]="this.devices.drainage.attrs[0].value"></td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('d2').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="d2" [value]="this.devices.drainage.attrs[1].value"></td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('d3').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="d3" [value]="this.devices.drainage.attrs[2].value"></td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('d4').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="d4" [value]="this.devices.drainage.attrs[3].value"></td>
                </tr>
                <tr>
                  <td>Природный газ</td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('g1').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="g1" [value]="this.devices.gas.attrs[0].value"></td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('g2').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="g2" [value]="this.devices.gas.attrs[1].value"></td>
                  <td class="text-right"><input appIntnumber [ngClass]="{ 'is-invalid': !form.get('g3').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="g3" [value]="this.devices.gas.attrs[2].value"></td>
                  <td class="text-right"><input [ngClass]="{ 'is-invalid': !form.get('g4').valid }"
                      [readonly]="!(this.settings$ | async).canEdit" type="text" class="form-control"
                      formControlName="g4" [value]="this.devices.gas.attrs[3].value"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

</form>
<app-debugpanel *ngIf="(this.settings$ | async).showDebugPanel" [debugData]="this.printValue() | json"></app-debugpanel>