<!-- <div id="floater" *ngIf="(this.settings$ | async).canEdit">
  <div class="container">
    <div class="row">
      <div class="col-md-3" *ngIf="(this.settings$ | async).menuPosition"></div>
      <div class="col-md-9">
        <div class="card semitrans">
          <button class="btn btn-space btn-primary savebutton" form="ngform01">
            <i class="icon icon-left s7-config"></i> Сохранить
          </button>
        </div>
      </div>
    </div>
  </div>
</div> -->
<div class="panel panel-default">
  <div class="panel-body">
    <!-- <div
      role="alert"
      *ngIf="this.saveSuccess$ | async"
      class="alert alert-contrast alert-success alert-dismissible"
    >
      <div class="icon"><span class="s7-check"></span></div>
      <div class="message">
        <button type="button" (click)="this.clearMessage()" class="close">
          <span aria-hidden="true" class="s7-close"></span></button
        ><strong>Сохранено</strong>
        Данные успешно сохранены
      </div>
    </div>

    <div
      role="alert"
      *ngIf="this.saveFail$ | async"
      class="alert alert-contrast alert-danger alert-dismissible"
    >
      <div class="icon"><span class="s7-close"></span></div>
      <div class="message">
        <button type="button" (click)="this.clearMessage()" class="close">
          <span aria-hidden="true" class="s7-close"></span></button
        ><strong>Ошибка!</strong> Не удалось сохранить данные: {{ this.error }}
      </div>
    </div> -->
    <div class="row">
      <div class="col-sm-12">
        <button
          *ngIf="(this.settings$ | async).canEdit"
          style="float: right; outline: none; margin: 0px 20px 0px 0px"
          mat-raised-button
          color="primary"
          form="ngform01"
        >
          Сохранить
        </button>
        <button
        *ngIf="(this.settings$ | async).canEdit"
        style="float: right; outline: none; margin: 0px 20px 0px 0px"
        mat-raised-button
        color="primary"
      >
        Сравнить
      </button>
      </div>
    </div>

    <div class="row" *ngIf="this.tepFields">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-body pl-sm-5">
            <form
              (ngSubmit)="onSubmit(form.value)"
              id="ngform01"
              [formGroup]="form"
            >
              <div class="form-group row" *ngFor="let field of this.tepFields">
                <label class="col-md-4 col-form-label text-sm-right">{{
                  field.caption
                }}</label>
                <div *ngIf="field.showAs === 'string'" class="col-md-7">
                  <input
                    type="text"
                    [formControlName]="field.code"
                    id="{{ field.code }}"
                    name="{{ field.code }}"
                    value="{{ field.value }}"
                    class="form-control form-control-xs"
                  />
                </div>
                <ng-container
                  *ngIf="field.showAs === 'small' && field.type !== 'datetime'"
                >
                  <ng-container *ngIf="field.type === 'int'">
                    <div class="col-md-3 text-sm-right">
                      <input
                        type="text"
                        appIntnumber
                        [formControlName]="field.code"
                        id="{{ field.code }}"
                        [ngClass]="{
                          'is-invalid': submitted && !form.get(field.code).valid
                        }"
                        name="{{ field.code }}"
                        value="{{ field.value }}"
                        class="form-control text-sm-right form-control-xs"
                      />
                    </div>
                    <div
                      class="col-md-1"
                      *ngIf="
                        (this.settings$ | async)?.canEdit &&
                        field.value &&
                        field.value !== 0
                      "
                    >
                      <span
                        *ngIf="
                          this.form.controls[field.code].value / field.value <
                            0.9 ||
                          this.form.controls[field.code].value / field.value >
                            1.1
                        "
                        class="badge badge-pill badge-warning"
                        >10%</span
                      >
                    </div>
                  </ng-container>
                  <ng-container *ngIf="field.type === 'float'">
                    <div class="col-md-3 text-sm-right">
                      <input
                        type="text"
                        appFloatnumber
                        autocomplete="off"
                        [formControlName]="field.code"
                        id="{{ field.code }}"
                        [ngClass]="{
                          'is-invalid': submitted && !form.get(field.code).valid
                        }"
                        name="{{ field.code }}"
                        value="{{ field.value }}"
                        class="form-control text-sm-right form-control-xs"
                      />
                    </div>
                    <div
                      class="col-md-1"
                      *ngIf="
                        (this.settings$ | async)?.canEdit &&
                        field.value &&
                        field.value !== 0
                      "
                    >
                      <span
                        *ngIf="
                          this.form.controls[field.code].value / field.value <
                            0.9 ||
                          this.form.controls[field.code].value / field.value >
                            1.1
                        "
                        class="badge badge-pill badge-warning"
                        >10%</span
                      >
                    </div>
                  </ng-container>
                </ng-container>
                <div *ngIf="field.showAs === 'textarea'" class="col-md-7">
                  <textarea
                    id="{{ field.code }}"
                    [formControlName]="field.code"
                    rows="12"
                    value="{{ field.value }}"
                    name="{{ field.code }}"
                    class="form-control"
                  ></textarea>
                </div>
                <div
                  *ngIf="
                    field.showAs === 'select' &&
                    field.code !== 'category_id' &&
                    field.code !== 'management_org_id'
                  "
                  class="col-md-7"
                >
                  <ng-container *ngIf="!(this.settings$ | async).canEdit">
                    <ng-select
                      [items]="this.field.fieldoptions"
                      [multiple]="false"
                      class="custom"
                      [closeOnSelect]="true"
                      bindLabel="display"
                      bindValue="value"
                      [disabled]="true"
                      placeholder=""
                      [formControlName]="field.code"
                      [appendTo]="'body'"
                    >
                    </ng-select>
                  </ng-container>
                  <ng-container *ngIf="(this.settings$ | async).canEdit">
                    <ng-select
                      [items]="this.field.fieldoptions"
                      [multiple]="false"
                      class="custom"
                      [closeOnSelect]="true"
                      bindLabel="display"
                      bindValue="value"
                      placeholder=""
                      [formControlName]="field.code"
                      [appendTo]="'body'"
                    >
                    </ng-select>
                  </ng-container>
                </div>
                <div *ngIf="field.code === 'category_id'" class="col-md-7">
                  <ng-container *ngIf="!(this.settings$ | async).canEdit">
                    <ng-select
                      [items]="this.category_list$ | async"
                      [multiple]="false"
                      class="custom"
                      [closeOnSelect]="true"
                      bindLabel="name"
                      bindValue="id"
                      [disabled]="true"
                      placeholder=""
                      [formControlName]="field.code"
                      [appendTo]="'body'"
                    >
                    </ng-select>
                  </ng-container>
                  <ng-container *ngIf="(this.settings$ | async).canEdit">
                    <ng-select
                      [items]="this.category_list$ | async"
                      [multiple]="false"
                      class="custom"
                      [closeOnSelect]="true"
                      bindLabel="name"
                      bindValue="id"
                      placeholder=""
                      [formControlName]="field.code"
                      [appendTo]="'body'"
                      loadingText="Загрузка категорий..."
                    >
                    </ng-select>
                  </ng-container>
                </div>
                <div
                  *ngIf="field.code === 'management_org_id'"
                  class="col-md-7"
                >
                  <ng-container *ngIf="!(this.settings$ | async).canEdit">
                    <ng-select
                      [items]="this.management_org$ | async"
                      [multiple]="false"
                      class="custom"
                      [closeOnSelect]="true"
                      bindLabel="name"
                      bindValue="id"
                      [disabled]="true"
                      placeholder=""
                      [formControlName]="field.code"
                      [appendTo]="'body'"
                    >
                    </ng-select>
                  </ng-container>
                  <ng-container *ngIf="(this.settings$ | async).canEdit">
                    <ng-select
                      [items]="this.management_org$ | async"
                      [multiple]="false"
                      class="custom"
                      [closeOnSelect]="true"
                      bindLabel="name"
                      bindValue="id"
                      placeholder=""
                      [formControlName]="field.code"
                      [appendTo]="'body'"
                      loadingText="Загрузка организаций..."
                    >
                    </ng-select>
                  </ng-container>
                </div>
                <div *ngIf="field.showAs === 'check'" class="col-md-7">
                  <div
                    class="col-12 col-sm-8 col-lg-6 form-check mt-2"
                    *ngIf="!(this.settings$ | async).canEdit"
                  >
                    <label
                      class="custom-control custom-checkbox custom-control-inline"
                    >
                      <input
                        type="checkbox"
                        disabled="disabled"
                        [formControlName]="field.code"
                        [attr.checked]="field.value === 1"
                        id="{{ field.code }}"
                        name="{{ field.code }}"
                        class="custom-control-input is-invalid"
                      /><span
                        class="custom-control-label custom-control-color"
                      ></span>
                    </label>
                  </div>
                  <div
                    class="col-12 col-sm-8 col-lg-6 form-check mt-2"
                    *ngIf="(this.settings$ | async).canEdit"
                  >
                    <label
                      class="custom-control custom-checkbox custom-control-inline"
                    >
                      <input
                        type="checkbox"
                        [formControlName]="field.code"
                        [attr.checked]="field.value === 1"
                        id="{{ field.code }}"
                        name="{{ field.code }}"
                        class="custom-control-input is-invalid"
                      /><span
                        class="custom-control-label custom-control-color"
                      ></span>
                    </label>
                  </div>
                </div>
                <div
                  *ngIf="field.showAs === 'small' && field.type === 'datetime'"
                  class="col-md-3"
                >
                  <input
                    *ngIf="field.value"
                    type="date"
                    [formControlName]="field.code"
                    id="{{ field.code }}"
                    name="{{ field.code }}"
                    class="form-control text-sm-left form-control-xs"
                    [value]="field.value | date: 'yyyy-MM-dd'"
                  />

                  <input
                    *ngIf="field.value === null"
                    type="date"
                    [formControlName]="field.code"
                    id="{{ field.code }}"
                    name="{{ field.code }}"
                    class="form-control text-sm-left form-control-xs"
                  />
                </div>
                <label class="col-md-1 col-form-label text-sm-left">{{
                  field.unit
                }}</label>
              </div>
            </form>
            <app-debugpanel
              *ngIf="(this.settings$ | async).showDebugPanel"
              [debugData]="this.printValue() | json"
            ></app-debugpanel>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
